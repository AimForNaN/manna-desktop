<link href="https://fonts.googleapis.com/css?family=Abel|Armata|Arsenal:400,400i,700|Gafata|Gudea:400,400i,700|Istok+Web:400,400i,700,700i|Jaldi:400,700|Lateef|Mako|Maven+Pro:400,700|Muli:300,300i,400,400i,700,700i|Quicksand:300,400,700|Rajdhani:300,400,700|Tinos:400,400i,700,700i&amp;subset=arabic,greek,greek-ext,hebrew,latin-ext" rel="stylesheet">

<link rel="import" href="./bower_components/iron-icons/iron-icons.html">
<link rel="import" href="./bower_components/iron-pages/iron-pages.html">
<link rel="import" href="./bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="./bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="./bower_components/paper-item/paper-item.html">
<link rel="import" href="./bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="./bower_components/paper-slider/paper-slider.html">
<link rel="import" href="./bower_components/paper-toggle-button/paper-toggle-button.html">

<link rel="import" href="common.html">
<link rel="import" href="manna-desktop-module-view.html">

<dom-module id="manna-desktop-modules-view">
    <template>
        <style include="iron-flex iron-positioning">
            :host {
                background-color: #EEE;

                @apply(--layout-horizontal);
            }

			:host #pages {
            }

			:host #sidebar {
                background-color: #121920;
				color: #FFF;
                min-width: 54px;

				@apply(--layout-center);
				@apply(--layout-vertical);

				--paper-menu-focused-item-after: {
					content: none;
				};
            }

			:host #sidePanel {
				background-color: #FFF;
				color: #999;
				font-family: "Abel";
				min-width: 250px;
				width: 250px;
			}

			:host #sidePanel .panel {
				overflow-y: auto;
				padding: 8px;
			}

			:host #sidePanel .panel > * {
                margin: 0;
                padding: 8px 16px;
            }

            :host .content {
                @apply(--layout-flex);
                @apply(--layout-start);
                @apply(--layout-vertical);
            }

            :host .modules .list {
                overflow-y: auto;
            }

			:host .modules .list .module {
				border-bottom-style: solid;
				border-bottom-width: 1px;
				border-color: #FAFAFA;
				border-top-style: solid;
				border-top-width: 1px;
				color: #AAA;
				cursor: pointer;
				font-family: "Abel";
				font-size: 12pt;
				margin-top: -1px;
				min-height: 35px;

				--paper-item-focused-before: {
					content: none;
				};
			}

			:host .modules .list .module.selected {
				background-color: #FCFCFC;
				border-color: #F3F3F3;
				color: #222;
				font-weight: normal;
				z-index: 1;
			}

			:host .modules .list .module:hover {
				color: #555;
			}

			:host .module-view {
				border-right: 1px solid #E7E7E7;

				@apply(--layout-flex-auto);
				@apply(--layout-self-stretch);
			}

			:host .opened-modules {
				overflow: auto;

				@apply(--layout-flex);
				@apply(--layout-relative);
			}

			/* FONTS */
			:host .abel {
				font-family: 'Abel', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.75);
				line-height: 1.7em;
			}

			:host .armata {
				font-family: 'Armata', sans-serif;
				font-size: var(--manna-desktop-modules-view-text-size, 12pt);
				letter-spacing: -1px;
				line-height: 2.1em;
				word-spacing: 5px;
			}

			:host .arsenal {
				font-family: 'Arsenal', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.8);
				line-height: 1.5em;
				word-spacing: 1px;
			}

			:host .expletus-sans {
				font-family: 'Expletus Sans', sans-serif;
				font-size: var(--manna-desktop-modules-view-text-size, 12pt);
			}

			:host .gudea {
				font-family: 'Gudea', sans-serif;
				font-size: var(--manna-desktop-modules-view-text-size, 12pt);
			}

			:host .istok-web {
				font-family: 'Istok Web', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.9231);
			}

			:host .mako {
				font-family: 'Mako', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.8571);
				line-height: 1.6em;
			}

			:host .maven-pro {
				font-family: 'Maven Pro', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.8571);
				line-height: 1.3em;
			}

			:host .quicksand {
				font-family: 'Quicksand', sans-serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.7059);
				line-height: 1.4em;
			}

			:host .rajdhani {
				font-family: 'Rajdhani', sans-serif;
				font-size: var(--manna-desktop-modules-view-text-size, 12pt);
			}

			:host .tinos {
				font-family: 'Tinos', serif;
				font-size: calc(var(--manna-desktop-modules-view-text-size, 12pt) / 0.8571);
				line-height: 1.4em;
			}
        </style>
        <div class="content">
			<div class="layout horizontal self-stretch flex-auto">
				<paper-menu id="sidebar">
					<paper-icon-button icon="icons:text-format" on-tap="toggleFontSettings"></paper-icon-button>
				</paper-menu>
				<template is="dom-if" if="[[activeModules.length]]">
					<div class$="opened-modules [[_computeFontStyle(selectedFont)]]" id="openedModules">
						<div class="layout horizontal fit scroll start">
							<template as="module" is="dom-repeat" items="[[activeModules]]">
								<manna-desktop-module-view
								class="module-view"
								line-by-line="[[lineByLine]]"
								module="[[module]]"
								verse-numbers="[[verseNumbers]]"
								></manna-desktop-module-view>
							</template>
						</div>
					</div>
				</template>
			</div>
        </div>
		<iron-pages attr-for-selected="name" fallback-selection="modules" id="sidePanel" selected="modules">
			<div class="modules panel" name="modules">
				<h3>Modules</h3>
				<paper-listbox attr-for-selected="name" class="list" multi selected-values="{{selectedModules}}" selected-class="selected">
					<template as="module" is="dom-repeat" items="[[modules]]" filter="_filter">
						<paper-item class="module" name$="[[module.Name]]">[[module.Name]]</paper-item>
					</template>
				</paper-listbox>
			</div>
			<div class="font-settings panel" name="font-settings">
				<h3>Text Settings</h3>
				<paper-dropdown-menu label="Font">
					<paper-listbox attr-for-selected="name" class="dropdown-content" selected="{{selectedFont}}">
						<template as="font" is="dom-repeat" items="[[fonts]]">
							<paper-item name$="[[font]]">[[font]]</paper-item>
						</template>
					</paper-listbox>
				</paper-dropdown-menu>
				<template is="dom-if" if="[[isBiblicalTexts(filterType)]]">
					<paper-toggle-button checked="{{verseNumbers}}">Show verse numbers</paper-toggle-button>
					<paper-toggle-button checked="{{lineByLine}}">Show verses on their own line</paper-toggle-button>
					<div>Text Size</div>
					<paper-slider min="7" max="24" pin step="0.5" value="{{textSize}}"></paper-slider>
				</template>
			</div>
		</iron-pages>
    </template>
    <script>
        Polymer({
            is: 'manna-desktop-modules-view'
        ,   properties: {
				'activeModules': {
					type: Array
				,	computed: '_computeActiveModules(selectedModules.*, modules)'
				}
            ,   'filterType': {
                    type: String
                }
			,	'fonts': {
					type: Array
				,	value: function () {
						return [
							'Abel'
						,	'Armata'
						,	'Arsenal'
						,	'Expletus Sans'
						,	'Gudea'
						,	'Istok Web'
						,	'Mako'
						,	'Maven Pro'
						,	'Quicksand'
						,	'Rajdhani'
						,	'Tinos'
						];
					}
				}
			,	'lineByLine': {
					type: Boolean
				,	value: true
				}
			,	'modules': {
					type: Array
				,	value: []
				,	notify: true
				}
			,	'verseNumbers': {
					type: Boolean
				,	value: true
				}
			,	'selectedFont': {
					type: String
				,	value: 'Gudea'
				,	notify: true
				,	observer: '_computeFontStyle'
				}
			,	'selectedModules': {
					type: Array
				,	notify: true
				}
			,	'textSize': {
					type: Number
				,	value: 12
				,	observer: '_computeTextSize'
				}
            }
		,	_computeActiveModules: function (selected) {
				var ret = [];
				selected = this.selectedModules;
				if (selected) {
					var len = selected.length;
					for (var i = 0; i < len; ++i) {
						var name = selected[i]
						,	mod  = this.getModule(name)
						;
						if (mod) ret.push(mod);
					}
				}
				return ret;
			}
		,	_computeFontStyle: function (font) {
				console.log(this.$$('#openedModule'));
				font = String(font);
				font = font.toLowerCase();
				font = font.replace(/[\s]+/g, '-');
				return font;
			}
		,	_computeTextSize: function (size) {
				this.customStyle['--manna-desktop-modules-view-text-size'] = size + 'pt';
				this.updateStyles();
			}
		,	_filter: function (item) {
				if (this.filterType) {
					return this.filterType == item['Type']
				}
				return true;
			}
		,	getModule: function (name) {
				var len = this.modules.length;
				for (var i = 0; i < len; ++i) {
					var mod = this.modules[i];
					if (mod['Name'] == name) {
						return mod;
					}
				}
				return null;
			}
		,	isBiblicalTexts: function (filter) {
				return filter == 'Biblical Texts';
			}
		,	toggleFontSettings: function () {
				var sp = this.$.sidePanel;
				if (sp.selected == 'font-settings') {
					sp.select('');
				}
				else sp.select('font-settings');
			}
        });
    </script>
</dom-module>
